# Изменения: Глобальные настройки

## Описание проблемы
Настройки динамического бэкграунда и стартовой анимации сохранялись в `localStorage` браузера, что приводило к тому, что каждый пользователь на каждом устройстве имел свои собственные настройки. При изменении настроек в админке они применялись только для текущего браузера.

## Решение
Настройки перенесены на сервер и теперь хранятся в MongoDB. Это обеспечивает:
- Глобальное применение настроек для всех пользователей и устройств
- Централизованное управление через админ-панель
- Синхронизацию настроек в реальном времени

## Изменения в коде

### Backend (Server)

#### Новые файлы:
1. **`server/src/models/Settings.ts`** - Модель настроек для MongoDB
   - Хранит все глобальные настройки сайта
   - Поля: `showLoadingAnimation`, `showParticlesBackground`, и др.

2. **`server/src/routes/settings.ts`** - API маршруты для настроек
   - `GET /api/settings` - получение настроек (публичный)
   - `PUT /api/settings` - обновление настроек (только админ)

3. **`server/src/scripts/initSettings.ts`** - Скрипт инициализации
   - Создает настройки по умолчанию при первом запуске

#### Измененные файлы:
- **`server/src/index.ts`**
  - Добавлен импорт `settingsRoutes`
  - Добавлен роут `/api/settings`

- **`server/package.json`**
  - Добавлен скрипт `init-settings` для инициализации настроек

### Frontend (Client)

#### Новые файлы:
1. **`client/src/hooks/useSettings.ts`** - Хук для работы с настройками
   - Загружает настройки с сервера
   - Автоматически обновляется при изменении настроек
   - Предоставляет состояние загрузки и ошибок

2. **`client/src/vite-env.d.ts`** - TypeScript определения для Vite
   - Типизация переменных окружения

#### Измененные файлы:
1. **`client/src/pages/admin/AdminSettings.tsx`**
   - Удалена работа с `localStorage`
   - Добавлена загрузка настроек с API
   - Добавлено сохранение настроек через API
   - Добавлено событие `settingsUpdated` для синхронизации

2. **`client/src/App.tsx`**
   - Использует хук `useSettings` вместо `localStorage`
   - Загружает настройку `showLoadingAnimation` с сервера

3. **`client/src/pages/Home.tsx`**
   - Использует хук `useSettings` вместо `localStorage`
   - Загружает настройку `showParticlesBackground` с сервера

## Как использовать

### Инициализация настроек (первый запуск)
```bash
cd server
npm run init-settings
```

### Изменение настроек
1. Войдите в админ-панель: `/admin/settings`
2. Измените нужные настройки
3. Нажмите "Сохранить изменения"
4. Настройки применятся глобально для всех пользователей

### API Endpoints

#### Получить настройки (публичный)
```
GET /api/settings
```

#### Обновить настройки (требуется админ токен)
```
PUT /api/settings
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "showLoadingAnimation": false,
  "showParticlesBackground": true,
  ...
}
```

## Миграция с localStorage
При первом запуске после обновления:
1. Запустите скрипт инициализации: `npm run init-settings`
2. Настройки будут созданы со значениями по умолчанию
3. Старые настройки из `localStorage` больше не используются

## Настройки, которые теперь глобальные
- ✅ `showLoadingAnimation` - стартовая анимация
- ✅ `showParticlesBackground` - динамический фон
- ✅ `siteName` - название сайта
- ✅ `siteDescription` - описание
- ✅ `contactEmail` - email для связи
- ✅ `telegramBot` - Telegram бот
- ✅ `enableRegistration` - включить регистрацию
- ✅ `enableTelegramAuth` - авторизация через Telegram
- ✅ `maintenanceMode` - режим обслуживания

## Проверка работы
1. Откройте админ-панель и измените настройку динамического фона
2. Откройте сайт в другом браузере/устройстве
3. Настройка должна примениться автоматически
